# ⚡ MiniSwap

> **서버 없이, 계정 없이, 수수료 최소로** — MetaMask 지갑 하나로 USDT ↔ KRW 직거래

---

## 📌 프로젝트 개요

MiniSwap은 한국 시장을 타겟으로 한 **P2P USDT/KRW 거래 플랫폼**입니다.  
중앙화 거래소(CEX)의 높은 수수료, 복잡한 KYC, 출금 제한 문제를 해결하기 위해 설계됐습니다.

| 항목 | 내용 |
|------|------|
| 거래 방식 | P2P 직거래 (구매자 ↔ 판매자) |
| 신원 확인 | MetaMask 지갑 주소 = 신원 (회원가입 없음) |
| 자금 보호 | Arbitrum 스마트 컨트랙트 에스크로 |
| 서버 | 없음 (Serverless) |
| 오더북 방식 | 양방향 (판매 오더 + 구매 오더) |
| 타겟 네트워크 | Arbitrum (저렴한 Gas) |

---

## 🎯 핵심 원칙

### 1. 완전한 탈중앙화
- 중앙 서버 없음
- 오더북은 Trystero(WebRTC P2P) + IndexedDB로 관리
- 사용자 데이터 서버 전송 없음

### 2. 마찰 없는 온보딩
```
MetaMask 열기 → 연결 클릭 → 승인 → 거래 시작
(회원가입 ✗ / 이메일 ✗ / KYC ✗)
```

### 3. 스마트 컨트랙트 에스크로
- 판매자 USDT → 에스크로 컨트랙트 락
- 구매자 KRW 은행이체 후 → 판매자 확인 → 자동 릴리즈
- 분쟁 시 2-of-2 운영자 중재

### 4. Gas 비용 최소화
| 행위 | Gas |
|------|-----|
| 오더 올리기 | 없음 (P2P 메시지만) |
| 에스크로 락 | ~$0.10~0.15 |
| 릴리즈 | ~$0.05 |

---

## 💱 양방향 오더북 시스템

v4부터 **판매 오더**와 **구매 오더** 두 가지 타입 지원.

### 📤 판매 오더 (Sell Order)
> USDT를 팔고 싶은 사람이 올리는 오더

```
판매자가 오더 올림
  → 구매자들이 수락 요청
  → 판매자가 구매자 1명 선택
  → 에스크로 락
  → 구매자 KRW 송금
  → 판매자 확인 → 릴리즈
```

### 📥 구매 오더 (Buy Order)
> USDT를 사고 싶은 사람이 올리는 오더

```
구매자가 오더 올림
  → 판매자가 수락 (즉시 에스크로 락)
  → 구매자에게 계좌 공개
  → 구매자 KRW 송금
  → 판매자 확인 → 릴리즈
```

**핵심 차이**: 구매 오더 수락 시 판매자의 "구매자 선택" 단계가 없음 → 1단계 단축

---

## 🖥️ 화면 구성 (v4 · 20개 화면)

### 온보딩 (2개)
| ID | 화면명 | 설명 |
|----|--------|------|
| S01 | 시작 화면 | 앱 소개, MetaMask 연결 버튼 |
| S02 | MetaMask 연결 | 팝업 승인 1회 |

### 오더북 (3개)
| ID | 화면명 | 설명 |
|----|--------|------|
| S03 | 판매 오더 탭 | 주황 왼쪽 세로선. 구매자가 수락 |
| S04 | 구매 오더 탭 | 파란 왼쪽 세로선. 판매자가 수락 |
| S05 | 판매자 프로필 | 평점·거래내역 상세 |

### 판매자 플로우 A — 판매 오더 올리기 (5개)
| ID | 화면명 | 설명 |
|----|--------|------|
| S06 | 판매 오더 작성 | 수량·가격·계좌·유효시간 입력 |
| S07 | 구매자 선택 | Race Condition 해결, 판매자가 명시적 선택 |
| S08 | 에스크로 락 | MetaMask 팝업 2번 (approve + deposit) |
| S09 | 입금 확인 | 구매자 KRW 입금 확인 + 릴리즈 |
| S10 | 판매 완료 | 거래 완료 + 평점 대기 |

### 구매자 플로우 A — 판매 오더 수락 (4개)
| ID | 화면명 | 설명 |
|----|--------|------|
| S11 | 판매오더 상세 | 에스크로 온체인 검증 후 수락 가능 |
| S12 | 에스크로 대기 | 10분 타이머, 판매자 락 대기 |
| S13 | KRW 송금 | 복사 버튼 + 강제 체크박스 |
| S14 | 구매 완료 | 완료 + 판매자 평점 남기기 |

### 구매자 플로우 B — 구매 오더 올리기 (2개, 신규)
| ID | 화면명 | 설명 |
|----|--------|------|
| S15 | 구매 오더 작성 | 수량·가격·유효시간 입력 |
| S16 | 판매자 매칭 대기 | 오더북 게시됨, 판매자 수락 알림 대기 |

### 판매자 플로우 B — 구매 오더 수락 (2개, 신규)
| ID | 화면명 | 설명 |
|----|--------|------|
| S17 | 구매오더 상세 | 수락 즉시 에스크로 락 실행됨 안내 |
| S18 | 수락 + 에스크로 락 | 구매자 선택 단계 없이 바로 락 |

### 예외 처리 (2개)
| ID | 화면명 | 설명 |
|----|--------|------|
| S19 | 분쟁 신청 | 사유 선택 + 증거 자동 패키징 |
| S20 | 네트워크 오류 | 잘못된 체인 감지 → 자동 전환 |

---

## 🔐 보안 설계

### Race Condition 해결 (플로우 A)
여러 구매자가 동시에 수락 요청을 보내는 문제:
- 판매자가 **명시적으로 1명 선택** → 나머지 자동 거절
- 10분 타이머 내 에스크로 락 미완료 시 자동 취소

### 사용자 실수 방지
- KRW 금액 복사 버튼 (직접 입력 방지)
- 계좌번호 복사 버튼
- 강제 체크박스 (송금 완료 확인 2단계)
- 릴리즈 전 최종 경고 배너

### 에스크로 타임락
- 구매자가 7일 이내 클레임 없으면 판매자 자동 환불
- 분쟁 시 2-of-2 운영자 멀티시그 중재

---

## 📊 거래 수수료

| 항목 | 비율 |
|------|------|
| 플랫폼 수수료 | 2% (USDT에서 차감) |
| 네트워크 Gas | ~$0.15 (에스크로 락 시 1회) |

예시: 100 USDT 판매 → 구매자 수령 98 USDT

---

## 🗂️ 현재 개발 현황

- [x] 기술 스택 확정 (Phase 0 완료)
- [x] 6개 기술 문제 해결 (Race Condition, Gas 최적화 등)
- [x] 모바일 퍼스트 와이어프레임 v1~v4 완성
- [x] 양방향 오더북 UX 설계 완료 (20개 화면)
- [ ] Solidity 에스크로 컨트랙트 작성
- [ ] MetaMask 연동 JS 모듈 구현
- [ ] Trystero P2P 오더북 브로드캐스트
- [ ] IndexedDB 오더 저장 로직
- [ ] 메인넷 배포

---

## 📁 관련 파일

| 파일 | 설명 |
|------|------|
| `miniswap-v4.html` | 인터랙티브 프로토타입 (20개 화면) |
| `architecture.md` | 기술 아키텍처 상세 문서 |
